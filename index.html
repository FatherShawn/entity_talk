<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Entities: From Core to Custom</title>
    <link href='https://fonts.googleapis.com/css?family=Droid+Sans' rel='stylesheet' type='text/css'>
    <link href="css/normalize.css" rel="stylesheet" type="text/css">
    <link href="css/styles.css" rel="stylesheet" type="text/css">
    <link href="favicon.ico" rel="shortcut icon" type="image/x-icon">
</head>
<body>
<div id="impress">
    <div id="overview" class="step" data-x="-1000" data-y="-1000" data-scale="6"></div>
    <div id="title" class="step slide" data-x="-1000" data-y="-1000" data-scale="3">
        <div class="slide-text centered">
            <h1>Entities</h1>
            <h2>From Core to Custom</h2>
            <p>Shawn Duncan, Technical Architect</p>
            <p>Digital Pulp</p>
        </div>
        <div id="license">
            <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License"
                                                                                     src="https://i.creativecommons.org/l/by/4.0/88x31.png"/></a><span
                class="footer-text">This work is licensed under a <a rel="license"
                                                                     href="http://creativecommons.org/licenses/by/4.0/">Creative
            Commons Attribution 4.0 International License</a>.</span>
        </div>
    </div>
    <div id="data-container" class="step slide" data-x="-1000" data-y="-3150" data-scale="1">
        <div class="slide-text centered">
            <h1>The Idea of a Data Container</h1>
        </div>
    </div>
    <div class="step slide" data-x="-1350" data-y="-3150" data-z="-350" data-rotate-y="-90">
        <h2>The Idea of a Data Container</h2>
        <div class="data-container"><img src="images/container_ship_cropped.jpg"></div>
        <div class="slide-text">
            <ul>
                <li>An object that stores information.
                    <ul>
                        <li>Content</li>
                        <li>Configuration</li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <div class="step slide" data-x="-1000" data-y="-3500" data-z="-350" data-rotate-x="90">
        <h2>The Idea of a Data Container</h2>
        <div class="slide-text">
            <ul>
                <li>No actual Entity Class in D7 core.</li>
                <li>PHP Standard Objects
                    <ul>
                        <li>Node</li>
                        <li>User</li>
                        <li>Taxonomy</li>
                        <li>Comments</li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <div class="step slide" data-x="-650" data-y="-3150" data-z="-350" data-rotate-y="90">
        <h2>The Idea of a Data Container</h2>
        <div class="slide-text">
            <ul>
                <li>In Drupal 8, Entities are first class objects</li>
                <li>Content
                    <dl>
                        <dt><em>\Drupal\Core\Entity\ContentEntityBase</em></dt>
                        <dd><code>abstract class ContentEntityBase extends Entity implements \IteratorAggregate,
                            ContentEntityInterface</code></dd>
                    </dl>
                </li>
                <li>Configuration
                    <dl>
                        <dt><em>\Drupal\Core\Config\Entity\ConfigEntityBase</em></dt>
                        <dd><code>abstract class ConfigEntityBase extends Entity implements ConfigEntityInterface</code>
                        </dd>
                    </dl>
                </li>
                <li><a target="_blank" href="images/Entity.svg">UML</a></li>
            </ul>
        </div>
    </div>
    <div id="core-entities" class="step slide" data-x="1150" data-y="-1000" data-scale="1">
        <div class="slide-text centered">
            <h1>Working with Core Entities</h1>
        </div>
    </div>
    <div id="fieldable" class="step slide" data-x="800" data-y="-1000" data-z="-350" data-rotate-y="-90">
        <h2>Working with Core Entities</h2>
        <div class="data-diagram"><img src="images/related_data.png"></div>
        <div class="slide-text">
            <ul>
                <li>If you've been working with Drupal for multiple versions, now is the time to stop thinking in
                    nodes.
                </li>
                <li>Use fields to model your real processes and relationships.</li>
            </ul>
        </div>
    </div>
    <div class="step slide" data-x="1150" data-y="-1350" data-z="-350" data-rotate-x="90">
        <h2>Working with Core Entities</h2>
        <div class="slide-text">
            <ul>
                <li>QueryFactory: entity.query</li>
                <li>You may see blog post refering to the EntityManager Service
                    <ul>
                        <li>Deprecated</li>
                        <li>See: <a href="https://www.drupal.org/node/2549139" target="_blank">https://www.drupal.org/node/2549139</a>
                        </li>
                        <li>Use EntityTypeManger: entity_type.manager</li>
                    </ul>
                </li>
                <li>Accessing fields with methods.</li>
                <li>Setting field values. Check <code>::generateSampleValue</code> on the field class to get structure.
                </li>
            </ul>
        </div>
    </div>
    <div id="smarter" class="step slide" data-x="-1000" data-y="1150" data-scale="1">
        <div class="slide-text centered">
            <h1>Smarter Modules with Custom Entities</h1>
        </div>
    </div>
    <div class="step slide" data-x="-1350" data-y="1150" data-z="-350" data-rotate-y="-90">
        <h2 class="entity-detail-title">Classes, Files & Annotations<br>for Custom Content Entities</h2>
        <div class="slide-text">
            <ul>
                <li>An entity interface in the <code>/src</code> directory.
                    <ul>
                        <li>Conform your entity to multiple types by extending core interfaces.
                            <ul>
                                <li><code>ContentEntityInterface</code>
                                    <br>For obvious reasons...
                                </li>
                                <li><code>EntityChangedInterface</code>
                                    <ul>
                                        <li>Defines an interface for entity change timestamp tracking.</li>
                                        <li>Allows more precise cache invalidation.</li>
                                        <li>Disallows concurrent editing</li>
                                    </ul>
                                </li>
                                <li><code>EntityOwnerInterface</code>
                                    <br>Allow reassigning entity ownership.
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <div class="step slide" data-x="-1000" data-y="800" data-z="-350" data-rotate-x="90">
        <h2 class="entity-detail-title">Classes, Files & Annotations<br>for Custom Content Entities</h2>
        <div class="slide-text">
            <ul>
                <li>An entity class at <code>/src/Entity/</code>
                    <ul>
                        <li>extend <code>ContentEntityBase</code></li>
                        <li>implement the custom interface just discussed.</li>
                        <li><code>@ContentEntityType</code> Annotations
                            <ul>
                                <li>Refer to <code>\Drupal\Core\Entity\EntityType</code> for all possible properties
                                </li>
                                <li><em>id:</em> The unique identifier of this entityType.</li>
                                <li><em>label:</em> Human readable name of the entity type</li>
                                <li><em>handlers:</em> You can use handlers provided by parent or override with your
                                    own. Implement classes in <code>/src</code> for any overrides.
                                </li>
                                <li><em>base_table:</em> Define a unique name for the table used to store the data.</li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <div class="step slide" data-x="-650" data-y="1150" data-z="-350" data-rotate-y="90">
        <h2 class="entity-detail-title">Classes, Files & Annotations<br>for Custom Content Entities</h2>
        <div class="slide-text">
            <ul>
                <li>An entity class at <code>/src/Entity/</code>
                    <ul>
                        <li><code>@ContentEntityType</code> Annotations continued...
                            <ul>
                                <li><em>fieldable:</em> Can additional fields be added to the entity via the admin UI?
                                </li>
                                <li><em>entity_keys:</em> Map entity columns to standard keys.</li>
                                <li><em>links:</em> Provide routes to do standard tasks.</li>
                                <li><em>admin_permission:</em> The permission string. Must define in a <code>permissions.yml</code> file.
                                </li>
                            </ul>
                        </li>
                        <li> implement <code>baseFieldDefinitions</code>
                            <br>Base fields are fields that exist for every bundle. See: <code class="basefield-info">Drupal\Core\Entity\FieldableEntityInterface</code>.
                            Note that entities can have base fields without being designated <em>fieldable.</em></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <div class="step slide" data-x="-1000" data-y="1150" data-z="-700" data-rotate-y="180">
        <h2 class="entity-detail-title">Classes, Files & Annotations<br>for Custom Content Entities</h2>
        <div class="slide-text">
            <ul>
                <li>Customize your entity list by extending <code>EntityListBuilder</code>. Add a <code>list_builder</code> annotation.</li>
                <li>Handlers you may wish to implement:
                    <ul>
                        <li>views_data</li>
                        <li>forms for add/edit and delete</li>
                        <li>access (Pair with a <code>permissions.yml</code> file.)</li>
                        <li>route_provider</li>
                    </ul>
                </li>
                <li>A <code>routing.yml</code> file is not needed if you implement a route provider. <a href="https://www.drupal.org/node/2593577">https://www.drupal.org/node/2593577</a> </li>
                <li>Yaml files for local tasks, local actions and menu defaults. <a href="https://www.drupal.org/node/2302893">https://www.drupal.org/node/2302893</a> </li>
            </ul>
        </div>
    </div>
    <div class="step slide" data-x="-1000" data-y="2200">
        <h2 class="entity-detail-title">Classes, Files & Annotations<br>for Custom Configuration Entities</h2>
        <div class="slide-text">
            <ul>
                <li>Very Similar
                <ul>
                    <li>Extending <code>ConfigEntityInterface</code> & <code>ConfigEntityBase</code></li>
                    <li>Corresponding extensions of ConfigEntity classes for forms and list</li>
                    <li>Form controllers</li>
                    <li>Route provider</li>
                </ul>
                </li>
                <li>Need a <code>config/schema/module_name.schema.yml</code> file. This defines the schema for <em>yaml files</em> used to export the entity.</em></li>
                <li>Each property on the defining class should have a mapping in the <code>schema.yml</code></li>
            </ul>
        </div>
    </div>
    <div id="secret-sauce" class="step slide" data-x="-1000" data-y="2200" data-z="-1" data-rotate-y="180">
        <h2>The Secret Sauce</h2>
        <div class="slide-text">
            <ul>
                <li>Drupal Console</li>
                <li><code>drupal generate:module</code></li>
                <li><code>drupal generate:entity:content</code></li>
            </ul>
        </div>
    </div>
    <div id="resources" class="step slide" data-x="-3150" data-y="-1000" data-scale="1">
        <div class="slide-text centered">
            <h1>More Resources</h1>
        </div>
    </div>
    <div class="step slide" data-x="-3500" data-y="-1000" data-z="-350" data-rotate-y="-90">
        <h2>More Resources</h2>
        <div class="slide-text">
            <dl>
                <dt>The Example Project</dt>
                <dd><a>https://www.drupal.org/project/examples</a></dd>
                <dt>Content Entity Cheatsheet</dt>
                <dd><a>http://wizzlern.nl/drupal/drupal-8-entity-cheat-sheet</a></dd>
                <dt>Drupal Console</dt>
                <dd><a>https://drupalconsole.com</a></dd>
            </dl>
        </div>
    </div>
    <div id="questions" class="step slide" data-x="-3150" data-y="-650" data-z="-350" data-rotate-x="-90">
        <h2>Open Q & A</h2>
        <div class="slide-text">
            <h3>&OpenCurlyDoubleQuote;Bring him here.&CloseCurlyDoubleQuote;</h3>
            <img src="images/Yoda_Attack_of_the_Clones.png">
            <h3>&OpenCurlyDoubleQuote;Question him we will.&CloseCurlyDoubleQuote;</h3>
        </div>
    </div>
</div>
<script src="js/impress.js"></script>
<script>impress().init();</script>
</body>
</html>